---
name: Меню добавления/редактирования коровы
overview: Исправление заголовка при добавлении коровы, устранение наложения полей на подписи, валидация номера, группировка полей, кнопка «Очистить форму», доступность и замена «Осеменитель» на «Техник ИО».
todos:
  - id: fix-title
    content: В navigate() при screenId === 'add' без currentEditingId ставить заголовок и clearForm()
    status: completed
  - id: fix-overlap
    content: В forms.css поправить сетку и gap для .form-cow-editor
    status: completed
  - id: validate-cattle-id
    content: Валидация уникальности номера коровы при добавлении (saveCurrentEntry)
    status: completed
  - id: group-fields
    content: Группировка полей формы (блоки с подзаголовками в index.html + стили)
    status: completed
  - id: clear-form-btn
    content: Кнопка «Очистить форму» на экране добавления (только когда !currentEditingId)
    status: completed
  - id: accessibility
    content: Доступность — aria-label для кнопок, проверка label/for, фокус
    status: completed
  - id: rename-inseminator
    content: Замена «Осеменитель» на «Техник ИО» везде (HTML, JS, Excel)
    status: completed
isProject: false
---

# План: меню добавления/редактирования коровы

## 1. Заголовок «Редактирование коровы 5706» при нажатии «Добавить корову»

**Причина:** При переходе по кнопке «Добавить животное» вызывается только `navigate('add')`. В `[js/menu.js](js/menu.js)` в функции `navigate()` нет обработки экрана `add`, поэтому заголовок и `window.currentEditingId` не сбрасываются. Если пользователь перед этим редактировал какую-то корову (например, 5706), при следующем открытии экрана «добавить» остаются старый заголовок и данные формы.

**Решение:** В `navigate()` добавить ветку для `screenId === 'add'`: при переходе на экран добавления, если **не** идём в режиме редактирования (`!window.currentEditingId`), явно устанавливать заголовок «➕ Добавить корову» и вызывать `clearForm()`. Аналогичные правки — в `[electron/js/menu.js](electron/js/menu.js)`, если навигация дублируется.

```js
// В navigate(), после других if (screenId === ...):
if (screenId === 'add') {
  if (!window.currentEditingId) {
    var titleEl = document.getElementById('addScreenTitle');
    if (titleEl) titleEl.textContent = '➕ Добавить корову';
    if (typeof clearForm === 'function') clearForm();
  }
}
```

---

## 2. Поля «заплывают» на названия полей

**Причина:** В `[css/forms.css](css/forms.css)` форма `.form-cow-editor` задана как сетка с колонками `auto 1fr auto 1fr` и небольшим вертикальным отступом (`gap: 0.4rem 1.25rem`). Колонка `auto` для подписей может сжиматься (особенно при длинных текстах вроде «ПДО (дней от отёла до 1-го осеменения)»), а при узкой области или неожиданном переносе строк визуально кажется, что поля наезжают на подписи.

**Решение:**

- Задать для колонок с подписями минимальную ширину, чтобы они не сжимались: например `minmax(10ch, auto)` или `minmax(140px, auto)` вместо первого и третьего `auto`.
- Увеличить вертикальный зазор между строками (например `0.75rem` или `1rem` по вертикали), чтобы пара «подпись — поле» визуально отделялась от следующей.
- При необходимости выровнять подписи по левому краю и убедиться, что у инпутов нет отрицательных отступов (сейчас их нет — достаточно поправить сетку и gap).

Пример правки в `forms.css`:

```css
.form-cow-editor {
  grid-template-columns: minmax(140px, auto) 1fr minmax(140px, auto) 1fr;
  gap: 0.75rem 1.25rem;  /* больше по вертикали */
  align-items: start;    /* выравнивание по верху, чтобы длинные подписи не «сползали» */
}
```

В медиазапросе для узких экранов (`max-width: 640px`) уже одна колонка `1fr` — порядок в разметке «label, input, label, input...» даёт корректные пары; при увеличении вертикального gap перекрытия уменьшатся.

---

## 3. Валидация номера коровы при добавлении

При сохранении **новой** записи (когда `!window.currentEditingId`) перед созданием записи проверять: есть ли уже запись с таким `cattleId` в `entries`. Если да — не сохранять, показать сообщение (toast или alert): «Корова с таким номером уже есть» и оставить пользователя на форме. Логику добавить в функцию сохранения (в [js/app.js](js/app.js) — там вызывается `saveCurrentEntry` / логика сохранения новой записи). При **редактировании** существующей коровы проверять дубликат только если новый номер отличается от `currentEditingId` и уже занят другой записью.

---

## 4. Группировка полей формы

Визуально разбить форму добавления/редактирования на блоки с подзаголовками (например `<h2 class="form-section-title">` или `<fieldset><legend>`):

- **Основные данные:** Номер коровы, Кличка, Группа, Дата рождения, Лактация.
- **Отел и осеменение:** Дата отёла, Дата осеменения, Номер попытки, Бык, Техник ИО, Код, Статус.
- **Сухостой и протокол:** Начало сухостоя, ПДО, Протокол, Начало протокола.
- **Выбытие и примечание:** Дата выбытия, Примечание.

Разметку менять в [index.html](index.html) (и в [electron/index.html](electron/index.html) при дублировании). В [css/forms.css](css/forms.css) добавить стили для секций: отступы, граница или фон блока, отступ у подзаголовка. Сетка `.form-cow-editor` может охватывать каждую секцию отдельно или общую обёртку с секциями внутри.

---

## 5. Кнопка «Очистить форму»

На экране добавления/редактирования ([index.html](index.html) — форма с `id="add-screen"`) добавить кнопку «Очистить форму», которая вызывает `clearForm()`. Показывать её **только в режиме добавления** (`!window.currentEditingId`): при переходе на экран `add` без `currentEditingId` кнопку показывать, при открытии формы через «Редактировать» — скрывать (через JS при `navigate('add')` и в `editEntry()`). Разместить рядом с «Отмена» / «Сохранить» (например перед «Отмена»). В [electron/index.html](electron/index.html) — аналогично.

---

## 6. Доступность

- **Кнопки:** для кнопок «Сохранить», «Отмена», «Назад», «Очистить форму» добавить `aria-label` с понятным текстом (где ещё нет явной подписи или контекста).
- **Форма:** убедиться, что у всех полей формы есть связанные `<label for="id">` (в текущей разметке уже есть) и что `id` у полей совпадают с `for` у label.
- **Экран add:** у заголовка `addScreenTitle` можно добавить `aria-live="polite"` при смене заголовка (добавление/редактирование), чтобы скринридер объявил смену.
- **Фокус:** при открытии экрана добавления/редактирования опционально ставить фокус на первое поле (`cattleId`) — в ветке `screenId === 'add'` в `navigate()` или в отдельной инициализации экрана.

---

## 7. Замена «Осеменитель» на «Техник ИО» везде

Заменить текст «Осеменитель» на «Техник ИО» во всех местах интерфейса и экспорта (название поля для пользователя; ключ данных `inseminator` не менять).

**Файлы и места:**

- **[index.html](index.html):** лейбл для `inseminator` в форме коровы; лейбл для поля осеменения (форма осеменения).
- **[electron/index.html](electron/index.html):** те же два места.
- **[js/field-config.js](js/field-config.js):** `label: 'Осеменитель'` → `'Техник ИО'`.
- **[electron/js/field-config.js](electron/js/field-config.js):** то же.
- **[js/export-import.js](js/export-import.js):** в массиве колонок `label: 'Осеменитель'` → `'Техник ИО'`.
- **[electron/js/export-import.js](electron/js/export-import.js):** то же.
- **[js/view-cow.js](js/view-cow.js):** заголовок таблицы осеменений `<th>Осеменитель</th>`, текст в карточке «Осеменитель:», заголовок в конфиге колонок `'Осеменитель'`.
- **[electron/js/view-cow.js](electron/js/view-cow.js):** те же три места.
- **[js/export-excel.js](js/export-excel.js):** заголовки колонок «Осеменитель» в основном листе и в листе осеменений.
- **[electron/js/export-excel.js](electron/js/export-excel.js):** то же.

План выполнять по шагам: 1 → 2 → 7 (замена термина) → 3 → 4 → 5 → 6.