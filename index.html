<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–£—á—ë—Ç –∫–æ—Ä–æ–≤ ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4a90e2" />
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π -->
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="auth-screen" class="screen">
    <h1>–í—Ö–æ–¥</h1>
    <div id="auth-form-container" class="auth-form-container">
      <form id="authLoginForm" class="form" onsubmit="handleLogin(event)">
        <label for="authUsername">–õ–æ–≥–∏–Ω</label>
        <input type="text" id="authUsername" required />
        <label for="authPassword">–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="authPassword" autocomplete="current-password" required />
        <div class="form-actions">
          <button type="submit">–í–æ–π—Ç–∏</button>
          <button type="button" onclick="showAuthRegister()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
      </form>
      <form id="authRegisterForm" class="form" style="display: none;" onsubmit="handleRegister(event)">
        <label for="regUsername">–õ–æ–≥–∏–Ω</label>
        <input type="text" id="regUsername" required />
        <label for="regPassword">–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="regPassword" autocomplete="new-password" required />
        <label for="regRole">–†–æ–ª—å</label>
        <select id="regRole">
          <option value="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä</option>
          <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
          <option value="viewer">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</option>
        </select>
        <div class="form-actions">
          <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
          <button type="button" onclick="showAuthLogin()">–ù–∞–∑–∞–¥ –∫ –≤—Ö–æ–¥—É</button>
        </div>
      </form>
    </div>
    <button type="button" class="back-button" onclick="skipAuth()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –≤—Ö–æ–¥–∞</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –º–µ–Ω—é -->
  <div id="menu-screen" class="screen active">
    <h1>–ú–µ–Ω—é</h1>
    <div id="auth-bar" class="auth-bar" style="display: none;">
      <span id="authBarUser"></span>
      <button type="button" class="small-btn" onclick="handleLogout()">–í—ã–π—Ç–∏</button>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞–¥–∞ -->
    <div class="herd-stats">
      <div class="stat-item">
        <div class="stat-value" id="totalCows">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ –∫–æ—Ä–æ–≤</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="pregnantCows">0</div>
        <div class="stat-label">–°—Ç–µ–ª—å–Ω—ã—Ö</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="dryCows">0</div>
        <div class="stat-label">–í —Å—É—Ö–æ—Å—Ç–æ–µ</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="inseminatedCows">0</div>
        <div class="stat-label">–û—Å–µ–º–µ–Ω—ë–Ω–Ω—ã—Ö</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="cullCows">0</div>
        <div class="stat-label">–ù–∞ –±—Ä–∞–∫</div>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="action-buttons">
      <button onclick="navigate('add')" class="action-btn">
        <span>‚ûï</span>
        <span>–î–æ–±–∞–≤–∏—Ç—å –∂–∏–≤–æ—Ç–Ω–æ–µ</span>
      </button>
      <button onclick="navigate('insemination')" class="action-btn">
        <span>üêÑ</span>
        <span>–í–≤–µ—Å—Ç–∏ –æ—Å–µ–º–µ–Ω–µ–Ω–∏–µ</span>
      </button>
      <button onclick="exportToExcel()" class="action-btn">
        <span>üì§</span>
        <span>–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</span>
      </button>
      <button onclick="downloadTemplate()" class="action-btn">
        <span>üìã</span>
        <span>–®–∞–±–ª–æ–Ω –∏–º–ø–æ—Ä—Ç–∞</span>
      </button>
      <button onclick="document.getElementById('importFile').click()" class="action-btn">
        <span>üì•</span>
        <span>–ò–º–ø–æ—Ä—Ç –∏–∑ Excel</span>
      </button>
      <input type="file" id="importFile" accept=".csv,.xlsx" style="display: none;" onchange="handleImportFile(event)">
      <button onclick="navigate('view')" class="action-btn">
        <span>üìã</span>
        <span>–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–ø–∏—Å–∏</span>
      </button>
      <button onclick="navigate('all-inseminations')" class="action-btn">
        <span>üìë</span>
        <span>–í—Å–µ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è</span>
      </button>
      <button onclick="navigate('notifications')" class="action-btn">
        <span>üîî</span>
        <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
      </button>
      <button onclick="navigate('analytics')" class="action-btn">
        <span>üìä</span>
        <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
      </button>
      <button onclick="navigate('auth')" class="action-btn">
        <span>üë§</span>
        <span>–í–æ–π—Ç–∏ / –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
      </button>
      <button onclick="navigate('backup')" class="action-btn">
        <span>üíæ</span>
        <span>–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</span>
      </button>
      <button onclick="cleanAllEntries()" class="action-btn" style="background-color: #ffc107;">
        <span>üßπ</span>
        <span>–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
      </button>
      <button onclick="if(confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã (–∑–∞–ø–∏—Å–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ–ø–∏–∏) –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) deleteAllData()" class="action-btn" style="background-color: #dc3545;">
        <span>üóëÔ∏è</span>
        <span>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ</span>
      </button>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è -->
  <div id="insemination-screen" class="screen">
    <h1>‚ûï –í–≤–µ—Å—Ç–∏ –æ—Å–µ–º–µ–Ω–µ–Ω–∏–µ</h1>
    <form class="form" onsubmit="addInseminationEntry(); return false;">
      <label for="cattleIdInsemInput">–ù–æ–º–µ—Ä –∫–æ—Ä–æ–≤—ã *</label>
      <div class="autocomplete">
        <input type="text" id="cattleIdInsemInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞" required />
        <ul id="cattleIdInsemList" class="autocomplete-list"></ul>
        <select id="cattleIdInsem" style="display: none;">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–æ–≤—É</option>
        </select>
      </div>

      <label for="inseminationDateInsem">–î–∞—Ç–∞ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è</label>
      <input type="date" id="inseminationDateInsem" />

      <label for="attemptNumberInsem">–ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏</label>
      <input type="number" id="attemptNumberInsem" value="1" />

      <label for="bullInsem">–ë—ã–∫</label>
      <input type="text" id="bullInsem" />

      <label for="inseminatorInsem">–û—Å–µ–º–µ–Ω–∏—Ç–µ–ª—å</label>
      <input type="text" id="inseminatorInsem" />

      <label for="codeInsem">–ö–æ–¥ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è</label>
      <input type="text" id="codeInsem" />

      <div class="form-actions">
        <button type="button" onclick="navigate('menu')" id="cancelButtonInsem">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" id="saveButtonInsem">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
    <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div id="add-screen" class="screen">
    <h1 id="addScreenTitle">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–æ–≤—É</h1>
    <form class="form" onsubmit="saveCurrentEntry(); return false;">
      <label for="cattleId">–ù–æ–º–µ—Ä –∫–æ—Ä–æ–≤—ã *</label>
      <input type="text" id="cattleId" required />

      <label for="nickname">–ö–ª–∏—á–∫–∞</label>
      <input type="text" id="nickname" />

      <label for="birthDate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
      <input type="date" id="birthDate" />

      <label for="lactation">–õ–∞–∫—Ç–∞—Ü–∏—è</label>
      <input type="number" id="lactation" min="1" max="20" placeholder="‚Äî" />

      <label for="calvingDate">–î–∞—Ç–∞ –æ—Ç—ë–ª–∞</label>
      <input type="date" id="calvingDate" />

      <label for="inseminationDate">–î–∞—Ç–∞ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è</label>
      <input type="date" id="inseminationDate" />

      <label for="attemptNumber">–ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏</label>
      <input type="number" id="attemptNumber" value="1" />

      <label for="bull">–ë—ã–∫</label>
      <input type="text" id="bull" />

      <label for="inseminator">–û—Å–µ–º–µ–Ω–∏—Ç–µ–ª—å</label>
      <input type="text" id="inseminator" />

      <label for="code">–ö–æ–¥</label>
      <input type="text" id="code" />

      <label for="status">–°—Ç–∞—Ç—É—Å</label>
      <select id="status">
        <option value="">‚Äî</option>
        <option>–û—Å–µ–º–µ–Ω–µ–Ω–Ω–∞—è</option>
        <option>–•–æ–ª–æ—Å—Ç–∞—è</option>
        <option>–°—Ç–µ–ª—å–Ω–∞—è</option>
        <option>–°—É—Ö–æ—Å—Ç–æ–π</option>
        <option>–û—Ç—ë–ª</option>
        <option>–ë—Ä–∞–∫</option>
      </select>

      <label for="exitDate">–î–∞—Ç–∞ –≤—ã–±—ã—Ç–∏—è</label>
      <input type="date" id="exitDate" />

      <label for="dryStartDate">–ù–∞—á–∞–ª–æ —Å—É—Ö–æ—Å—Ç–æ—è</label>
      <input type="date" id="dryStartDate" />

      <label for="vwp">–ü–î–û (–¥–Ω–µ–π –æ—Ç –æ—Ç—ë–ª–∞ –¥–æ 1-–≥–æ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è)</label>
      <input type="text" id="vwp" readonly placeholder="‚Äî" title="–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏" />

      <label for="protocolName">–ü—Ä–æ—Ç–æ–∫–æ–ª</label>
      <input type="text" id="protocolName" />

      <label for="protocolStartDate">–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞</label>
      <input type="date" id="protocolStartDate" />

      <label for="note">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
      <textarea id="note"></textarea>

      <div class="form-actions">
        <button type="button" onclick="cancelEdit()" id="cancelButton">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" id="saveButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>

    <div id="entriesList"></div>
    <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–ø–∏—Å–µ–π -->
  <div id="view-screen" class="screen view-screen">
    <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: –∑–∞–∫—Ä–µ–ø–ª—ë–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ —Å–ø–∏—Å–∫–∞ -->
    <div class="view-screen-header">
      <button onclick="navigate('menu')" class="back-button view-screen-back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
      <h1>üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–ø–∏—Å–∏</h1>
      <div id="search-filter-container" class="search-filter-container"></div>
      <div id="viewBulkActions" class="view-bulk-actions"></div>
    </div>
    <div id="viewEntriesList" class="view-entries-wrapper"></div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ -->
  <div id="view-cow-screen" class="screen view-cow-screen">
    <div class="view-cow-header">
      <button onclick="navigate('view')" class="back-button view-cow-back">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
      <h1>üîç –ü—Ä–æ—Å–º–æ—Ç—Ä –∂–∏–≤–æ—Ç–Ω–æ–≥–æ</h1>
    </div>
    <div id="viewCowCard" class="view-cow-body"></div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω ¬´–í—Å–µ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è¬ª -->
  <div id="all-inseminations-screen" class="screen">
    <div class="view-screen-header" style="position: sticky; top: 0; background: #f5f5f5; padding: 10px 12px; z-index: 10;">
      <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
      <h1>üìë –í—Å–µ –æ—Å–µ–º–µ–Ω–µ–Ω–∏—è</h1>
    </div>
    <div id="allInseminationsList" class="view-entries-wrapper" style="padding: 12px; overflow: auto;"></div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
  <div id="notifications-screen" class="screen">
    <h1>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
    <div id="notification-center-container"></div>
    <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
  <div id="analytics-screen" class="screen">
    <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
    <div class="analytics-controls">
      <label>–ü–µ—Ä–∏–æ–¥: <select id="analyticsPeriod">
        <option value="month">–ú–µ—Å—è—Ü</option>
        <option value="quarter">–ö–≤–∞—Ä—Ç–∞–ª</option>
        <option value="year">–ì–æ–¥</option>
      </select></label>
      <button type="button" id="analyticsRefreshBtn" class="small-btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <div id="analyticsIndicators" class="analytics-indicators"></div>
    <div id="analyticsCharts" class="analytics-charts"></div>
    <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div id="backup-screen" class="screen">
    <h1>üíæ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</h1>
    <div id="backup-container"></div>
    <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
  <div id="sync-screen" class="screen">
    <h1>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h1>
    <div class="sync-controls">
      <button onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
      <label for="importFileJson">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)
        <input type="file" id="importFileJson" accept=".json" onchange="importData(event)" />
      </label>
      <div id="syncStatus" class="sync-status"></div>
    </div>
    <button onclick="navigate('menu')" class="back-button">–ù–∞–∑–∞–¥</button>
  </div>

   <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ -->
  <!-- PapaParse –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV, Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤, SheetJS –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ xlsx -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/events.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/core.js"></script>
  <script src="js/users.js"></script>
  <script src="js/ui-helpers.js"></script>
  <script src="js/cow-operations.js"></script>
  <script src="js/voice-handler.js"></script>
  <script src="js/app.js"></script>
  <script src="js/sync.js"></script>
  <script src="js/export.js"></script>
  <script src="js/insemination.js"></script>
  <script src="js/view-cow.js"></script>
  <script src="js/search-filter.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/analytics.js"></script>
  <script src="js/backup.js"></script>
  <!-- menu.js –ø–æ—Å–ª–µ–¥–Ω–∏–º: —Å–ø–∏—Å–æ–∫ —Å –≥—Ä—É–ø–ø–æ–≤—ã–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º (updateViewList) –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è -->
  <script src="js/menu.js"></script>
</body>
</html>