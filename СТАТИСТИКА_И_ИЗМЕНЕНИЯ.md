# Статистика проекта и последние изменения

## Строки кода (приблизительно)

Подсчёт по основным каталогам исходников (без `node_modules`, без сгенерированного `dist/` и копий в `electron/web/`):

| Часть проекта | Строк | Описание |
|---------------|-------|----------|
| **Веб-приложение (js/)** | ~9 100 | Точка входа `main.tsx`, `App.tsx`, 32 модуля (config, storage, core, api, ui, features), типы |
| **Сервер (server/)** | ~850 | Node.js, SQLite, маршруты API, авторизация, чат |
| **Стили (css/)** | ~2 950 | Сводные и экранные стили, компоненты, печать |
| **Разметка** | ~660 | `index.html` (экраны, формы, скрипты) |
| **Unit-тесты (tests/)** | ~156 | Vitest: analytics-calc, search-filter |
| **E2E (e2e/)** | ~520 | Playwright: smoke-тесты веб и Electron, запуск/остановка |
| **Electron (оболочка)** | ~450 | `main.js`, `preload.js`, `copy-web.js`, конфиги (без копий веб-кода) |

**Итого по поддерживаемым исходникам:** порядка **14 700 строк** (JS/TS, HTML, CSS, тесты, скрипты сборки).

> Сборка (`vite build`) даёт один бандл `dist/app.js` (~333 КБ с React). Исходные модули не дублируются в подсчёте; копии в `electron/js/` и `electron/web/` не учитываются.

---

## Потраченное время и этапы разработки

Точное время по задачам в проекте не фиксируется. Ниже — логические этапы последней большой доработки (миграция на современный стек).

| Этап | Содержание |
|------|------------|
| **Фаза 1** | Введение Vite: замена конкатенации на `vite build`, один бандл `dist/app.js`, копирование в `dist/` (index, css, icons), обновление Electron (`copy-web.js`) и Capacitor (`webDir: "dist"`). |
| **Фаза 2** | Переход на ES-модули: единая точка входа `main.js` → `main.tsx`, все скрипты как модули с `export`, общение через `window.*`, правки storage/core и тестов (Vitest с ESM). |
| **Фаза 3** | TypeScript: `tsconfig.json`, точка входа на `.ts`/`.tsx`, `global.d.ts` для расширений `window`, сборка и проверка `tsc --noEmit`. |
| **Фаза 4** | React: установка React/ReactDOM, корневой компонент `App.tsx`, монтирование в `<div id="root">`, удаление заглушек навигации/авторизации из `index.html`. |

Итог: сборка — Vite, модули — ESM, типы — TypeScript, UI-основа — React; экраны по-прежнему на разметке и глобальных обработчиках, с возможностью постепенного переноса в React.

---

## Последние изменения (оформление для документации)

### Сборка и инфраструктура

- **Сборка:** вместо конкатенации скриптов (`node scripts/build.js`) используется **Vite** (`npm run build`). Результат — один файл `dist/app.js`.
- **Точка входа:** `js/main.tsx` — импортирует все модули приложения в нужном порядке и монтирует React-корень в `#root`.
- **Конфигурация:** `vite.config.js` (сборка, копирование index/css/icons/manifest/sw в `dist/`), `tsconfig.json` (ES2020, ESNext, strict, JSX).

### Модульность

- Все скрипты приложения переведены в **ES-модули** (обязательный `export` в каждом файле).
- Взаимодействие с разметкой и между модулями — через **`window`** (например, `window.navigate`, `window.entries`, `window.getCurrentObjectId`), чтобы не ломать существующие `onclick` в HTML.
- Единый порядок загрузки задаётся в `main.tsx` (config → utils → storage → core → ui → features → menu).

### TypeScript

- В проекте включён **TypeScript**: точка входа и корневой компонент на `.tsx`, типы для расширений `window` в `js/global.d.ts`.
- Остальные файлы пока в `.js`; при необходимости их можно переименовывать в `.ts`/`.tsx` и дополнять типами по мере доработок.

### React

- Подключены **React** и **ReactDOM**; корневой компонент — `js/App.tsx` (пока пустая оболочка).
- В `index.html`: в начале `<body>` добавлен `<div id="root"></div>`, после загрузки бандла в него монтируется React.
- Удалён блок-заглушка в `index.html`, который определял `window.navigate`, `showAuthRegister`, `showAuthLogin`, `navigateToSubmenu` и привязку кнопок при отсутствии бандла (бандл теперь всегда подключается).

### Платформы

- **Веб:** после `npm run build` приложение открывается по `index.html` из корня (скрипт `dist/app.js`) или раздаётся `dist/` (например, `npx serve dist`).
- **Electron:** `electron/copy-web.js` перед сборкой вызывает `npm run build` и копирует содержимое `dist/` в `electron/web/`; в копии `index.html` путь к скрипту заменён на `web/app.js`.
- **Capacitor:** в `package.json` задано `"webDir": "dist"` — мобильные сборки берут готовый каталог `dist/`.

### Тесты

- **Unit-тесты (Vitest):** работают с ESM; модули `analytics-calc.js` и `search-filter.js` экспортируют функции, тесты подключают их через `import`. Запуск: `npm run test`.
- **E2E (Playwright):** без изменений концепции; при необходимости обновляются команды запуска и селекторы под актуальную разметку.

### Удалённое

- Удалены скрипт конкатенации `scripts/build.js` и временная точка входа `js/entry.js` (используется только `js/main.tsx`).

---

## Как обновить локальную документацию

- **README.md** — уже описывает установку через `npm run build` и структуру; при желании в раздел «Структура проекта» можно добавить упоминание `js/main.tsx`, `js/App.tsx`, Vite и `dist/`.
- **ДОКУМЕНТАЦИЯ.md** — пользовательское описание приложения; технические детали стеков вынесены в этот файл (**СТАТИСТИКА_И_ИЗМЕНЕНИЯ.md**).

При необходимости можно добавить в **README.md** короткую ссылку на этот файл, например:  
*«Статистика строк кода и последние архитектурные изменения — см. [СТАТИСТИКА_И_ИЗМЕНЕНИЯ.md](СТАТИСТИКА_И_ИЗМЕНЕНИЯ.md).»*
