# Документация по проекту «Учёт коров»

Описание приложения, его возможностей и работы — простым языком, без технических деталей реализации.

---

## О чём этот проект

**«Учёт коров»** — программа для учёта поголовья на молочной ферме. В ней ведут карточки животных, фиксируют осеменения, отёлы, сухостой, протоколы и получают аналитику по стаду. Приложение рассчитано на работу в хозяйстве: с телефона, планшета или компьютера, при необходимости без интернета.

Цель — дать одно понятное место, где собраны все данные по коровам, напоминания и отчёты, и при необходимости — общая база для нескольких пользователей через сервер.

---

## Для кого это

- **Операторы и зоотехники** — ежедневный ввод осеменений, отёлов, запусков, УЗИ, привязка к протоколам.
- **Руководители и специалисты** — просмотр списков, фильтрация, аналитика (PR, CR, HDR, сервис-период), уведомления и планы.
- **Администраторы** — настройка пользователей, резервные копии, синхронизация с сервером, при необходимости — чат-консультант по работе с программой.

Приложение можно использовать в одиночку (всё хранится на устройстве) или подключить к общему серверу — тогда одни и те же данные видят все пользователи хозяйства.

---

## Основной функционал

### Карточка животного

На каждую корову заводится запись. В ней хранятся:

- номер и кличка;
- дата рождения, группа (место содержания), лактация;
- даты отёла и осеменения, номер попытки, бык, техник-осеменатор, код осеменения (охота, РеСИНХ, ОВСИНХ и др.);
- статус: охота, сухостой, отёл, сухостой вынужденный, отёл вынужденный;
- привязка к протоколу и дата постановки на протокол;
- история осеменений, отёлов, УЗИ и других действий;
- примечания.

Запись можно создать, отредактировать или удалить. По номеру коровы можно быстро перейти к карточке из списка или с экранов «Ввести осеменение», «Запуск», «Отел», «УЗИ», «Поставить на протокол».

### Действия

- **Ввести осеменение** — форма с выбором коровы, датой, быком, попыткой, кодом и т.д.
- **Запуск** — фиксация начала сухостоя с датой.
- **Отел** — ввод даты отёла.
- **УЗИ** — дата проверки на стельность и результат (стельная / не стельная).
- **Поставить на протокол** — выбор протокола и даты постановки.

Все действия привязываются к выбранной корове и попадают в её историю и в общие списки.

### Просмотр и поиск

- **Список всех животных** — таблица с настраиваемым набором колонок, сортировкой и массовым выделением (например, для удаления нескольких записей).
- **Все осеменения** — список осеменений по стаду.
- **Поиск** — по номеру, кличке, статусу, быку, коду, примечанию, осеменатору, протоколу. Результат обновляется по мере ввода.
- **Фильтры** — по статусу, лактации, периоду дат осеменения, признаку «синхронизировано с сервером». Настройки фильтров сохраняются между сессиями.
- Кнопка **Сбросить** — очистка поиска и фильтров и показ полного списка.

При большом количестве записей список отображается с «виртуальной» прокруткой: подгружаются только видимые строки, чтобы интерфейс оставался быстрым.

### Уведомления

Программа периодически проверяет данные и формирует напоминания:

- предстоящий отёл (за 7, 3 и 1 день);
- рекомендация осеменения (прошло 60 и более дней после отёла);
- напоминание о запуске в сухостой;
- наличие записей, ещё не отправленных на сервер (в режиме работы с сервером).

Уведомления отображаются на главном экране и в отдельном разделе «Уведомления», где можно посмотреть историю, принудительно перепроверить данные и очистить историю. При разрешении пользователя возможны и браузерные (push) уведомления.

### Аналитика

- **Показатели за период** (месяц, квартал или год):  
  PR (доля стельности), CR (доля оплодотворения по попыткам), HDR (доля выявленной охоты), сервис-период (среднее число дней от отёла до осеменения).
- **Графики** — столбцы по показателям и круговая диаграмма по статусам животных.
- **Интервальный анализ** — разбивка по месяцам в выбранном диапазоне.

Расчёты опираются на отёлы, осеменения и статусы из карточек; период и тип отчёта задаёт пользователь.

### Несколько баз (объектов)

Можно вести несколько независимых баз в одном установленном приложении (например, по фермам или по годам). Переключатель «Объект» на главном экране позволяет выбрать текущую базу. Данные разных баз хранятся раздельно. В режиме работы с сервером список объектов и переключение между ними согласованы с сервером.

### Пользователи и роли (при работе через сервер)

Если указан адрес сервера и пользователь входит по логину и паролю:

- **Администратор** — видит и может изменять все записи в выбранной базе.
- **Оператор** — видит и редактирует только те записи, которые создал или к которым привязан; новые записи помечаются его учётной записью.
- **Только просмотр** — доступ только на чтение к своим записям.

Без входа или без сервера приложение работает в «локальном» режиме: все данные доступны любому, кто открыл программу на этом устройстве.

### Резервные копии

- **Создать копию** — сохранение снимка текущих записей выбранной базы внутри браузера (до 10 копий, старые автоматически удаляются).
- **Восстановить** — подставить выбранную копию вместо текущих данных (с подтверждением).
- **Экспорт в файл** — скачать все данные выбранной базы в одном файле (формат JSON).
- **Импорт из файла** — загрузить ранее сохранённый файл и заменить им текущие записи (с подтверждением).

Резервы помогают не потерять данные при сбоях и при переходе на новое устройство или новую установку.

### Синхронизация с сервером

Когда в настройках указан адрес сервера:

- Приложение подключается к общему API: загружает списки баз и записи, сохраняет изменения на сервер.
- На экране «Синхронизация» отображаются статус подключения, кнопки «Обновить с сервера» и «Синхронизация» (отправка локальных изменений), список баз на сервере, импорт выбранной базы в новый или существующий объект.
- Адрес сервера задаётся в разделе «Вход» (Настройки → Войти / Пользователи). Для кнопки «Подключиться к серверу» на экране Синхронизация при необходимости настраивается адрес по умолчанию (в конфигурации развёртывания).

Синхронизация идёт только через этот сервер; отдельной синхронизации с внешними таблицами (например, Google) в приложении нет.

### Экспорт и импорт таблиц

- **Экспорт в Excel** — выгрузка списка животных или осеменений в таблицу (XLSX) с настраиваемым набором полей и при необходимости по шаблону.
- **Импорт из CSV/Excel** — загрузка данных из файла: для каждого номера коровы программа либо добавляет новую запись, либо обновляет существующую по выбранному соответствию столбцов. Поддерживаются кириллица и разные разделители.
- **Шаблон импорта** — возможность скачать шаблон таблицы для заполнения и последующего импорта.

Это упрощает обмен данными с другими системами учёта или отчётностью.

### Чат-консультант

При подключённом сервере и настроенном на сервере доступе к нейросети (DeepSeek) доступен чат: пользователь задаёт вопросы по работе программы, а ответы формируются на основе документации проекта. Чат открывается из Настроек; в десктопной версии — также из меню «Справка» и по правому клику по экрану («Вызвать консультанта»).

### Голосовой ввод

В поддерживаемых окружениях можно вызывать голосового помощника (по имени «Гена»), по очереди называть номер коровы, кличку, даты, быка, попытку, статус и т.д., затем сказать «Запиши» — данные подставляются в форму. Это ускоряет ввод «в полевых» условиях.

### Печать и офлайн

- Подготовлен печатный вид описи стада (шапка под бланк, дата, список).
- Приложение можно установить как веб-приложение (PWA) на телефон или компьютер и использовать без постоянного интернета: интерфейс и данные кэшируются, работа продолжается локально до следующей синхронизации с сервером (если он настроен).

---

## Как устроена работа приложения (без технических деталей)

### Режим «только на устройстве»

Данные хранятся только на том устройстве, где открыто приложение. Все операции (добавление, изменение, удаление, аналитика, уведомления) выполняются локально. Резервные копии и экспорт в файл позволяют перенести данные на другой компьютер или сохранить их отдельно.

### Режим «с сервером»

Пользователь указывает адрес сервера и при необходимости входит по логину и паролю. После этого приложение обменивается данными с сервером: подгружает списки баз и записи, отправляет новые и изменённые записи, удаления. Один и тот же адрес сервера у всех пользователей даёт общую базу — все видят и меняют одни и те же данные в рамках своих прав. Сервер хранит данные в своей базе (SQLite), разграничивает доступ по ролям и при необходимости ограничивает частоту запросов к входу (защита от перебора паролей).

### Сборка и обновление

Перед первым запуском веб-версии выполняется сборка: скрипты приложения объединяются в один файл, который затем загружается в браузере. Это ускоряет загрузку и упрощает обновление. Для десктопной версии тот же веб-интерфейс копируется в папку сборки и упаковывается в установщик; при обновлении кода нужно заново собрать и установить программу. Установленная десктопная версия может проверять наличие новой версии в интернете (через релизы на GitHub) и предлагать скачать обновление.

### Тесты и качество

Для ключевой логики (поиск и фильтрация записей, расчёты аналитики) написаны автоматические тесты. Они запускаются по команде и проверяют, что при изменении кода расчёты и фильтры остаются корректными. Это снижает риск ошибок при доработках.

---

## Платформы

- **Веб** — открытие в браузере с любого устройства (после сборки и при наличии собранного файла приложения). Можно развернуть на своём веб-сервере или открывать локальный файл.
- **Десктоп** — отдельная сборка в виде установочного приложения (окно программы, меню, проверка обновлений). Исходный интерфейс и логика те же, что в веб-версии; меняется только способ запуска и упаковки.
- **Мобильные** — подготовка проекта под Android и iOS через Capacitor: тот же веб-интерфейс запускается внутри нативного приложения. Сборка и публикация в магазины выполняются в Android Studio и Xcode.

На всех платформах можно работать как локально, так и с общим сервером (указав его адрес в настройках).

---

## Безопасность и надёжность

- **Вход по логину и паролю** — пароли на сервере хранятся в зашифрованном виде; для доступа выдаётся токен с ограниченным сроком действия.
- **Ограничение попыток входа** — сервер ограничивает число попыток входа с одного адреса за короткий промежуток времени, чтобы затруднить подбор пароля.
- **Роли** — администратор, оператор и режим «только просмотр» задают, кто что может видеть и менять.
- **Резервы и экспорт** — пользователь может в любой момент создать копию данных или выгрузить их в файл и хранить отдельно.

Рекомендуется для доступа к серверу из интернета использовать HTTPS (сервер за обратным прокси с SSL). В локальной сети допустим незашифрованный доступ по IP и порту.

---

## Краткое резюме

«Учёт коров» — это единое приложение для учёта поголовья, осеменений, отёлов и аналитики на ферме. Оно работает в браузере, на компьютере и на мобильных устройствах, при необходимости без интернета. Данные можно хранить только на устройстве или синхронизировать через общий сервер с разграничением прав. В программе есть поиск и фильтры, уведомления, отчёты и графики, резервные копии, экспорт и импорт таблиц, при необходимости — чат-консультант по работе с программой и голосовой ввод. Документация по установке, запуску сервера и сборке десктопной и мобильной версий приведена в основных файлах проекта (README и MULTIPLATFORM).
